Задачи

Рассылка оповещений через телеграмм 
- подписка на телеграмм канал 
- отправка сообщений (трансляция)
данные храним в базе mysql

Порядок работы
1) админ  добавляет разрешенные api_key, команда 'new_api_key'
2) используя api_key экземпляр приложения получает личную session, команда 'new_app'
3) используя session, приложение регистрирует абонента за 2 шага.  Первый шаг это получение chek_code, команда 'new_abonent'
	по этой команде сервер создает случайное число chek_code  
	сохраняет его в в таблицу abonents и отправляет его приложению.
	приложение показывает chek_code  абоненту.
4) абонент самостоятельно подписывается на телеграмм канал и отправляет chek_code
5) от Telegramm  приходит сообщение chek_code от абонента с chat_id. 
	для тестирования можно отправить запрос - на сервер Telegramm запрос https://api.telegram.org/bot <token> /getUpdates?offset=-2 удаляет все кроме двух последних
	но  нужен Webhook - телеграм  сам отправляет тот же объект ответа  методом POST
	ответ для getUpdates  и запрос для Webhook  -  json объект  {update_id: 3456, message: "345678"},  message: "345678"  -  это chek_code
6) сервер добавляет chat_id в таблицу abonents соответствующую chek_code 
7) Второй шаг. Приложение отправляет запрос серверу  read_abonent_list и получает пары  chek_code - chat_id
8) приложение используя session  и chat_id   отправляет сообщение серверу
9) сервер используя chat_id отправляет сообщение в Telegramm командой sendMessage
пример с  GET https://api.telegram.org/bot <token> /sendMessage?chat_id=549079751&text=hello world
везде используем post  на адрес
https://api.telegram.org/bot <token> /sendMessage
информация  по работе с телеграмм API   https://tlgrm.ru/docs/bots/api#sendmessage

Таблицы 

api_keys - список разрешенных ключей
	name - первычный ключ
	api_key

sessions  - список сессий
	session - первычный ключ
	id - справочная информация о приложении

	
abonents - список абонентов 
	chat_id - первычный ключ
	session
	chek_code


ПРОТОКОЛ

Регистрация приложения
объект запроса
{
	api_key:'2345678',
	command:'new_app',
	data: {
		id: '65476538'
	}
}
объект ответа
{
	command:'new_app',	
	data: {
		id: '65476538'
		session: '3456324567'
	}
}
	session - действует до нового запроса на регистрацию приложения


регистрвция абонента
объект запроса
{
	session: '3456324567'
	command:'new_abonent',
	data: {}
}
объект ответа
{
	command:'new_abonent',	
	data: {
		chek_code:'342567'
	}
}
	chek_code -  случайное число 6 знаков, создает сервер


получить список новых подписанных абонентов
объект запроса
{
	session: '3456324567'
	command:'read_abonent_list',
	data: {
		list:['342567', '452976']  //список chek_code по которым приложение еще не получило chat_id
	}  
}
объект ответа
{
	command:'read_abonent_list',	
	data: {
		list:[
			{chek_code:'342567', chat_id:'654764764'},
			{chek_code:'452976', chat_id:'654097865'}
		]
	}
}

отправить сообщение 
объект запроса
{
	session: '3456324567'
	command:'send_msg',
	data: {
		chat_id:'654764764',
		text_msg:'Hello World!'
	}
}
объект ответа
{
	command:'send_msg',	
	data: {
		chat_id:'654764764',
		result: 'ok'
	}
}

добавить(изменить) разрешенный api_key 
объект запроса
{
	admin_key:'74965',
	command:'new_api_key',
	data: {
		name: 'vasa',
		api_key: '5286'
	}
}
объект ответа
{
	command:'new_api_key',	
	data: {
		name: 'vasa',
		result: 'edit', ('new')
	}
}

удалить name 
объект запроса
{
	admin_key:'74965',
	command:'dell_name',
	data: {
		name: 'vasa',
	}
}
объект ответа
{
	command:'dell_name',	
	data: {
		name: 'vasa',
		result: 'dell'
	}
}

admin_key - хранится прямо в коде сервера в виде объявления переменной
<token>  -  хранится прямо в коде сервера в виде объявления переменной

запрос - на сервер Telegramm запрос https://api.telegram.org/ <token> /getUpdates?offset=947952519  -  это "update_id":947952519 - последнее обработаное сообщение
пример ответа, 2 сообщения 
{"ok":true,"result":[{"update_id":947952519,
"message":{"message_id":11,"from":{"id":549079751,"is_bot":false,"first_name":"\u041c\u0443\u0440\u0430\u0442","last_name":"\u0417\u0438\u0433\u0430\u043d\u0448\u0438\u043d","language_code":"ru"},"chat":{"id":549079751,"first_name":"\u041c\u0443\u0440\u0430\u0442","last_name":"\u0417\u0438\u0433\u0430\u043d\u0448\u0438\u043d","type":"private"},"date":1653940280,"text":"two"}},{"update_id":947952520,
"message":{"message_id":12,"from":{"id":549079751,"is_bot":false,"first_name":"\u041c\u0443\u0440\u0430\u0442","last_name":"\u0417\u0438\u0433\u0430\u043d\u0448\u0438\u043d","language_code":"ru"},"chat":{"id":549079751,"first_name":"\u041c\u0443\u0440\u0430\u0442","last_name":"\u0417\u0438\u0433\u0430\u043d\u0448\u0438\u043d","type":"private"},"date":1653940323,"text":"three"}}]}

"from":{"id":549079751  - абонент
"chat":{"id":549079751  - бот


регистрация сервера в телеграмм
и получение хук от телеграмм