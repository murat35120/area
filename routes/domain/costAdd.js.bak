const express = require("express");
const PriceModel = require("../../models/Price");

const router = express.Router({ mergeParams: true });

router.post("/cost_add", async function (req, res) {
    if(!req.body.date || !Array.isArray(req.body.times) || !req.body.times.length) return res.status(400).send("Wrong body");
	console.log(req.body.perk);
	console.log(req.body);
    try{
        const splitedDate = req.body.date.split(".").map(v => Number(v));
        for(const time of req.body.times){
            const splitedTime = time.time.split(":").map(v => Number(v));
            const date = new Date(splitedDate[0], (+splitedDate[1] - 1), splitedDate[2], splitedTime[0], splitedTime[1], splitedTime[2], 0);
            await PriceModel.create({domain: companies.indexOf(req.params.domain) + 1, date: req.body.date, time: date, perk: Number(req.body.perk), cost: time.cost });
        }
        res.sendStatus(200);
    } catch(err){
		console.log(err);
        res.status(500).send("Error on server");
    }
});
module.exports = router;